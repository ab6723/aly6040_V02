---
title: "Module 2 Final Project â€” Milestone 1: EDA"
author: "Abby Bridgers and Justin Ehringhaus"
date: "July 24, 2022"
output:
  html_document: default
bibliography: "references.bib"
nocite: '@*'
---
justin test
---

```{r setup, include=FALSE}
# repo: https://github.com/ab6723/aly6040_V02
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(pacman)
library(hrbrthemes)
p_load(tidyverse)  # usual suite of packages
p_load(ggthemes)   # extra themes
p_load(skimr)      # alternative to summary(), skims dataset: skim()
p_load(VIM)        # visualization of missing values: aggr()
p_load(corrplot)   # visualization of a correlation matrix: corrplot()
```

---

## Data Preparation

```{r}
wvs <- read_csv("../WVS_Cross-National_Wave_7_csv_v4_0.csv")
head(wvs)[,1:5]
```

```{r}
wvs_subset <- 
  wvs %>% 
  select(
    Country = B_COUNTRY_ALPHA,
    Longitude = O1_LONGITUDE,
    Latitude = O2_LATITUDE,
    Age = Q262,
    Income.Group = Q288,
    Ethnic.Group = Q290, # see WVS_codebook.pdf for Q290 coding info
    Immigrant = Q263,
    Religion = Q289,
    Marital.Status = Q273,
    Education = Q275,
    Number.Children = Q274,
    Happiness = Q46,
    Health = Q47,
    votes.locally = Q221,
    votes.nationally = Q222,
    cheating.taxes = Q180,
    gov.video.surveillance = Q196,
    gov.email.monitoring = Q197,
    gov.collecting.info = Q198,
    terrorism = Q192,
    death.penalty = Q195,
    suicide = Q187,
    beating.wife = Q189,
    beating.children = Q190,
    homosexuality = Q182,
    prostitution = Q183,
    abortion = Q184,
    divorce = Q185,
    casual.sex = Q193,
    sex.before.marriage = Q186,
    )
```

## Analysis & Interpretation

```{r}
skim(wvs_subset)
```

...Write about observations of the skim here...

```{r}
# getting rid of nominal data / continuous data
# only want to assess correlations between ordinal data
wvs_subset_ordinal <- 
  wvs_subset %>% 
  select(-Longitude,
         -Latitude,
         -Country, 
         -Ethnic.Group, 
         -Religion)

cor <- cor(wvs_subset_ordinal, use = "pairwise.complete.obs")
corrplot(cor, 
         method = "circle", 
         insig = "blank", 
         diag = FALSE,
         tl.cex = 0.7) %>% 
    corrRect(name = c('Age', 
                      'votes.locally', 
                      'cheating.taxes', 
                      'homosexuality', 
                      'sex.before.marriage'))
```

...Write about observations of correlation matrix here...

```{r}
# Testing this... not working, but just an idea for long/lat values
p_load(maps)
map("world")
points(wvs_subset$Latitude, wvs_subset$Longitude, col = "red", pch = ".", cex = 2)
```

```{r}
Religion.names <- c('No Religion', 'Roman Catholic', 'Protestant', 'Orthodox',
                    'Jew', 'Muslim', 'Hindu', 'Buddhist', 'Other Christian', 'Other', 'NA')

wvs_subset %>% 
  ggplot +
  aes(x = factor(Number.Children), fill = factor(Religion)) +
  geom_bar(position = "fill") +
  scale_fill_discrete(name = "Religious Denomination",
                      labels = Religion.names) +
  xlab("Number of Children") +
  ylab("Proportion") +
  theme_tufte()
```

- For almost all counts of children, Muslims proportionally dominate other religious denominations.
- Those without a religion generally have fewer children.
- It appears outliers are present, such as families with 12+ children, this can be checked by running:

```{r}
table(wvs_subset$Number.Children, wvs_subset$Religion)
```

## Analysis & Interpretation - Subset 2

```{r}
colnames(wvs_subset)
wvs_subset2 <- wvs %>% 
  select(Country = B_COUNTRY_ALPHA,
    Longitude = O1_LONGITUDE,
    Latitude = O2_LATITUDE,
    Settlement.type = H_SETTLEMENT,
    Country.and.year = S025,
    Town.size = G_TOWNSIZE2,
    Age = Q262,
    Income.group = Q288,
    Importance.leisure.time = Q3,
    Importance.work = Q5,
    Happiness = Q46,
    Health = Q47,
    Confidence.elections = Q76,
    Confidence.courts = Q70,
    Confidence.UN = Q83,
    Environment.vs.econgrow = Q111,
    Job.scarcity.prioritize.nonimmigrants = Q34,
    Immigration.in.country.fills.useful.jobs = Q122,
    Immigration.in.country.strengthens.cultural.div = Q123,
    Immigration.in.country.increases.crime.rate = Q124,
    Immigration.in.country.gives.political.asylum = Q125,
    Immigration.in.country.increases.terrorism.risk = Q126,
    Immigration.in.country.helps.poor.people.est.new.lives = Q127,
    Immigration.in.country.increases.unemployment = Q128,
    Immigration.in.country.brings.social.conflict = Q129,
    Immigration.policy.preference = Q130)
```

# Checking out the subset
```{r}
colnames(wvs_subset2)
skim(wvs_subset2)
```

# working on a diverging bar chart...something slightly off but seems to be getting there. Will try to improve Sat and if that doesn't work, will delete
```{r}
#install.packages("formattable")
#library(formattable)
summary <- wvs_subset2 %>% 
  group_by(Importance.work, Age) %>% 
  count(Age = "n1") %>% 
  group_by(Importance.work) %>% 
  mutate(percent_resp = n1 / sum(n1)) %>% 
  ungroup() %>% 
  mutate(percent_resp_label = percent(n1))

summary

summary %>% 
  ggplot(aes(x = factor(Importance.work), y = percent_resp, fill = factor(Age))) + geom_col() + geom_text(aes(label = percent_resp_label), position = position_stack(vjust = 0.5),
                color = "white", fontface = "bold") + coord_flip() + scale_x_discrete() + scale_fill_viridis_d() + labs (title = "Xx", x = NULL, fill = NULL) + theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        panel.grid = element_blank(),
        legend.position = "top")
```

# basic barchart
```{r}
ggplot(wvs_subset2, aes(x=Confidence.courts, y=Age)) + 
  geom_bar(stat = "identity")
```

# age hist
```{r}
p <- wvs_subset2 %>%
  filter( Age>17 ) %>%
  ggplot( aes(x=Age)) +
    geom_histogram( binwidth=3, fill="#69b3a2", color="#e9ecef", alpha=0.9) +
    ggtitle("Bin size = 3") +
    theme_ipsum() +
    theme(
      plot.title = element_text(size=15)
    )
p
```

# tables & correlation
```{r}
table(wvs_subset2$Age, wvs_subset2$Immigration.in.country.brings.social.conflict)
prop.table(table(wvs_subset2$Age))

data.frame(colnames(wvs_subset2))
wvs_subset3 <- wvs_subset2[c(-1,-2,-3,-7, -11, -12)]
str(wvs_subset3)
cor(wvs_subset3, use = "complete.obs")
```

# age overlaid with income in prop bar chart
```{r}
library(ggthemes)
Income.details <- c('Lower Step', 'Second Step', 'Third Step', 'Fourth Step', 'Fifth Step', 'Sixth Step', 'Sixth Step', 'Seventh Step', 'Eigth Step', 'Nineth Step', 'Tenth Step', 'Unknown', 'No Answer', 'Not Asked', 'NA')

wvs_subset2 %>% 
  ggplot +
  aes(x = Age, fill = factor(Income.group)) +
  geom_bar(position = "fill") +
  scale_fill_discrete(name = "Income Group",
                      labels = Income.details) +
  xlab("Age") +
  ylab("Proportion") +
  ggtitle("Income Group Proportion By Age")
  theme_hc()
```

# likert() function -- WIP, will prob delete bc I haven't been able to figure it out :/
```{r}
#install.packages("HH")
#library(HH)
#likert(na.omit(wvs_subset2, Happiness~.))
#unique(wvs_subset2$Happiness)
unique(wvs_subset2$Health)

happiness12 <- head(na.omit(wvs_subset2$Happiness, 87000))
happiness1 <- factor(happiness12,
                       levels = c("1", "2", "3", "4"),
                       ordered = TRUE)
                       
health12 <- head(na.omit(wvs_subset2$Health, 87000))                     
health1 <- factor(health12,
                       levels = c("1", "2", "3", "4", "5"),
                       ordered = TRUE)

happ.health <- data.frame(happiness1, health1)
str(happ.health)

x123 = likert(happ.health) ## error here

summary(x123)
```

---

## TASKS

- Calculate appropriate summary statistics
- Create appropriate graphs that will give you insights into the data.

Include the answers to following questions:

- What did you do with the data in the context of exploration?
- How many entries are in the dataset?
- Was there missing data? Duplications? How clean was the data?
- Were their outliers or suspicious data?
- What did you do to clean the data?
- What did you find? What intrigued you about the data? Why does that matter?
- What would your proposed next steps be?
- What business questions do you plan to answer with your data mining?